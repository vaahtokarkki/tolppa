(this.webpackJsonptolppa=this.webpackJsonptolppa||[]).push([[0],{138:function(e,t,a){},143:function(e,t,a){"use strict";a.r(t);var n=a(4),r=a(0),c=a.n(r),s=a(14),i=a.n(s),o=a(81),l=a(25),u=a.n(l),j=a(52),d=a(10),b=a(43),m=a(184),h=a(185),x=a(183),O=a(199),f=a(188),p=a(193),v=a(100),g=a.n(v),w=a(101),k=a.n(w),y=a(186),S=a(198),Y=a(82),D=a.n(Y),C=a(192),M=a(200),N=a(17),F=a(187),H=a(189),I=a(191),P=a(190),E=a(99),T=a.n(E),L=a(102),B=a(195),z=a(197),A=a(194),W=a(21),q=a.n(W);a(138);D.a.defaults.withCredentials=!0;var J=D.a.create(),K="https://tolppa-gateway-nas5m5k7jq-lz.a.run.app";function U(e){return e<60?"".concat(e,"min"):"".concat(Math.floor(e/60),"h ").concat(e%60,"min")}var R=function(e){var t=Object(r.useState)(60),a=Object(d.a)(t,2),c=a[0],s=a[1],i=Object(r.useState)(0),l=Object(d.a)(i,2),v=l[0],w=l[1],Y=Object(r.useState)(null),D=Object(d.a)(Y,2),E=D[0],W=D[1],R=Object(r.useState)(null),G=Object(d.a)(R,2),Q=G[0],V=G[1],X=Object(r.useState)(window.localStorage.getItem("token")||""),Z=Object(d.a)(X,2),$=Z[0],_=Z[1],ee=Object(r.useState)(!0),te=Object(d.a)(ee,2),ae=te[0],ne=te[1],re=Object(r.useState)(new Date),ce=Object(d.a)(re,2),se=ce[0],ie=ce[1],oe=Object(r.useState)(new Date),le=Object(d.a)(oe,2),ue=le[0],je=le[1],de=Object(r.useState)(!0),be=Object(d.a)(de,2),me=be[0],he=be[1],xe=Object(r.useState)(!$),Oe=Object(d.a)(xe,2),fe=Oe[0],pe=Oe[1],ve=Object(r.useState)(window.localStorage.getItem("email")||""),ge=Object(d.a)(ve,2),we=ge[0],ke=ge[1],ye=Object(r.useState)(window.localStorage.getItem("password")||""),Se=Object(d.a)(ye,2),Ye=Se[0],De=Se[1],Ce=function(e){V({variant:"error",message:e}),ne(!1),W({error:!0})},Me=Object(r.useCallback)(Object(j.a)(u.a.mark((function e(){var t,a,n,r,c,s,i,o,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($){e.next=2;break}return e.abrupt("return",pe(!0));case 2:return e.prev=2,e.next=5,J.post("".concat(K,"/details"),{token:$});case 5:t=e.sent,a=t.data,n=a.reservations,r=a.state,c=a.licensePlate,s=a.temperature,i=a.consumption,W({reservations:n,state:r,licensePlate:c,temperature:s,consumption:i}),e.next=28;break;case 10:if(e.prev=10,e.t0=e.catch(2),console.log(e.t0),e.t0.response){e.next=15;break}return e.abrupt("return",Ce("Unknown error!"));case 15:o=e.t0.response.status,e.t1=o,e.next=400===e.t1?19:401===e.t1?21:25;break;case 19:return l="You need to set token!",e.abrupt("break",27);case 21:return l="Login failed",pe(!0),Ne(""),e.abrupt("break",27);case 25:return l="Unknown error!",e.abrupt("break",27);case 27:Ce(l);case 28:case"end":return e.stop()}}),e,null,[[2,10]])}))),[$]);!function(e,t){var a=Object(r.useRef)();Object(r.useEffect)((function(){a.current=e}),[e]),Object(r.useEffect)((function(){function e(){a.current()}if(null!==t){var n=setInterval(e,t);return function(){return clearInterval(n)}}}),[t])}(Me,ae?5e3:null),Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Me();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[Me]);var Ne=function(e){window.localStorage.setItem("token",e),_(e),ne(!!e)},Fe=function(){var e=Object(j.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(o.a)(Object(o.a)({},Ie()),{},{duration:c,eco:!1,token:$}),e.prev=1,e.next=4,J.post("".concat(K,"/timer"),t);case 4:V({variant:"success",message:"Timer sent to gateway successfully!"}),s(60),w(0),W(null),Me(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),V({variant:"error",message:e.t0.toString()});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}}(),He=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J.delete("".concat(K,"/timer"),{data:{token:$}});case 3:V({variant:"success",message:"All timers deleted successfully!"}),Me(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),V({variant:"error",message:e.t0.toString()});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),Ie=function(){return me?{endDate:q()().format("DD.MM.YYYY"),endTime:q()().add(v,"minutes").add(c,"minutes").format("HH:mm")}:{endDate:q()(se).format("DD.MM.YYYY"),endTime:q()(ue).format("HH:mm")}},Pe=function(){var e=Object(j.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J.post("".concat(K,"/login"),{email:we,password:Ye});case 3:t=e.sent,a=t.data,window.localStorage.setItem("email",we),window.localStorage.setItem("password",Ye),pe(!1),Ne(a.cookie),V(null),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),V({variant:"error",message:"Login failed ".concat(e.t0.toString())});case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return Object(n.jsx)("div",{className:"container",children:Object(n.jsxs)(x.a,{style:{maxWidth:300,width:300},children:[Q?Object(n.jsx)(B.a,{severity:Q.variant,children:Q.message}):null,fe?Object(n.jsx)(m.a,{children:Object(n.jsxs)(h.a,{children:[Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(b.a,{variant:"h6",children:"Login in to eParking"})}),Object(n.jsxs)(x.a,{item:!0,xs:12,className:"row",children:[Object(n.jsx)(A.a,{label:"Email",value:we,onChange:function(e){return ke(e.target.value)}}),Object(n.jsx)(A.a,{label:"Password",value:Ye,onChange:function(e){return De(e.target.value)},type:"password"})]}),Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(f.a,{variant:"contained",disabled:!we||!Ye,color:"primary",onClick:Pe,children:"Login"})})]})}):Object(n.jsxs)(n.Fragment,{children:[function(){if(!E)return Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(h.a,{children:Object(n.jsx)(y.a,{})})})});if(E.error)return Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(h.a,{children:Object(n.jsx)(b.a,{variant:"h6",children:"Tolppa status is unknown"})})})});var e=function(e){var t="DD.MM.YYYY HH:mm",a=q()();return e.find((function(e){var n=e.dateStart,r=e.dateEnd,c=e.timeStart,s=e.timeEnd,i=q()("".concat(n," ").concat(c),t),o=q()("".concat(r," ").concat(s),t);return i.isBefore(a)&&o.isAfter(a)}))}(E.reservations||[]),t=e?q()().diff(q()("".concat(e.dateStart," ").concat(e.timeStart),"DD.MM.YYYY HH:mm"),"minutes"):0;return Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsxs)(m.a,{children:[Object(n.jsx)(h.a,{className:E&&E.state?"status-on":"status-off",children:E&&E.state?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(b.a,{variant:"h6",children:"Your tolppa is on!"}),Object(n.jsxs)(b.a,{variant:"body1",children:["Car heated for ",t,"min! ","".concat(E.consumption,"W")]})]}):Object(n.jsx)(b.a,{variant:"h6",children:"Your tolppa is off!"})}),Object(n.jsxs)(h.a,{children:[Object(n.jsx)(b.a,{variant:"subtitle1",children:E.licensePlate}),Object(n.jsxs)(b.a,{variant:"body1",children:[E.temperature,"\xb0C, ",E.reservations.length,"/2 timers"]})]})]})})}(),E&&E.reservations&&E.reservations.length?Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(F.a,{children:E.reservations.map((function(e,t){var a=e.dateStart,r=e.timeStart,c=e.timeEnd,s=q()("".concat(a," ").concat(r),"DD.MM.YYYY HH:mm"),i=q()("".concat(a," ").concat(c),"DD.MM.YYYY HH:mm"),o=i.diff(s,"minutes"),l=q()().isBetween(s,i)?Object(n.jsx)(S.a,{variant:"outlined",className:"active-timer-chip",size:"small",label:"".concat(i.diff(q()(),"minutes"),"min left")}):null;return Object(n.jsxs)(H.a,{children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(T.a,{})}),Object(n.jsx)(I.a,{primary:"".concat(a,", ").concat(r,"-").concat(c),secondary:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("span",{children:"".concat(o," minutes")}),l]})})]},t)}))})})}):null,Object(n.jsxs)(N.a,{utils:L.a,children:[Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(h.a,{children:Object(n.jsxs)(x.a,{children:[Object(n.jsx)(x.a,{item:!0,xs:12,className:"center",children:Object(n.jsx)(p.a,{variant:"extended",color:"primary",onClick:function(){return he(!me)},children:me?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(g.a,{})," Schedule car heating"]}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(k.a,{})," Add quick timer"]})})}),me?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(x.a,{item:!0,xs:12,children:[Object(n.jsx)(z.a,{htmlFor:"dur",children:U(c)}),Object(n.jsx)(O.a,{label:"Duration",value:c,min:15,max:200,onChange:function(e,t){return s(t)},"aria-labelledby":"continuous-slider"})]}),Object(n.jsxs)(x.a,{item:!0,xs:12,children:[Object(n.jsxs)(z.a,{htmlFor:"dur",children:["Delay ",U(v)]}),Object(n.jsx)(O.a,{label:"Duration",value:v,min:0,max:200,onChange:function(e,t){return w(t)},"aria-labelledby":"continuous-slider"})]})]}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(x.a,{item:!0,xs:12,children:[Object(n.jsx)(z.a,{htmlFor:"dur",children:U(c)}),Object(n.jsx)(O.a,{label:"Duration",value:c,min:15,max:200,onChange:function(e,t){return s(t)},"aria-labelledby":"continuous-slider"})]}),Object(n.jsx)(x.a,{item:!0,xs:12,className:"form-row",children:Object(n.jsx)(C.a,{disableToolbar:!0,variant:"inline",format:"dd.MM.yyyy",margin:"normal",id:"date-picker-inline",label:"Date for new time",value:se,onChange:ie,KeyboardButtonProps:{"aria-label":"change date"}})}),Object(n.jsx)(x.a,{item:!0,xs:12,className:"form-row",children:Object(n.jsx)(M.a,{ampm:!1,margin:"normal",id:"time-picker",label:"When the car should be ready",value:ue,onChange:je,KeyboardButtonProps:{"aria-label":"change time"}})})]}),Object(n.jsx)(x.a,{item:!0,xs:12,style:{textAlign:"center",paddingTop:"1rem"},children:Object(n.jsx)(f.a,{variant:"contained",disabled:!$||E&&E.error,color:"primary",onClick:Fe,children:"Heat the car"})})]})})})}),Object(n.jsx)(m.a,{style:{textAlign:"center"},children:Object(n.jsxs)(h.a,{className:"button-card",children:[Object(n.jsx)(f.a,{size:"large",color:"secondary",variant:"outlined",disabled:!$||E&&E.error,onClick:He,children:"Clear all timers"}),Object(n.jsx)(f.a,{size:"large",color:"primary",variant:"outlined",onClick:function(){return window.open("https://eparking.fi/fi/u#/reservations")},children:"Manage reservations!"}),Object(n.jsx)(f.a,{size:"large",color:"secondary",variant:"outlined",onClick:function(){_(""),pe(!0),window.localStorage.removeItem("token"),ne(!1)},children:"Log out"})]})})]})]})]})})},G=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,203)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;a(e),n(e),r(e),c(e),s(e)}))};i.a.render(Object(n.jsx)(c.a.StrictMode,{children:Object(n.jsx)(R,{})}),document.getElementById("root")),G()}},[[143,1,2]]]);
//# sourceMappingURL=main.7296935b.chunk.js.map