(this.webpackJsonptolppa=this.webpackJsonptolppa||[]).push([[0],{139:function(e,t,a){},144:function(e,t,a){"use strict";a.r(t);var n=a(5),r=a(0),c=a.n(r),s=a(13),i=a.n(s),o=a(79),l=a(35),u=a.n(l),j=a(58),d=a(11),b=a(43),m=a(182),h=a(183),x=a(181),O=a(196),f=a(190),p=a(191),v=a(192),g=a(100),w=a.n(g),k=a(101),y=a.n(k),Y=a(184),S=a(80),D=a.n(S),C=a(189),M=a(197),H=a(17),N=a(185),F=a(186),T=a(188),E=a(187),I=a(99),P=a.n(I),A=a(102),B=a(193),z=a(195),L=a(23),W=a.n(L);a(139);D.a.defaults.withCredentials=!0;var q=D.a.create(),J="https://tolppa-gateway-nas5m5k7jq-lz.a.run.app";function K(e){return e<60?"".concat(e,"min"):"".concat(Math.floor(e/60),"h ").concat(e%60,"min")}var U=function(e){var t=Object(r.useState)(60),a=Object(d.a)(t,2),c=a[0],s=a[1],i=Object(r.useState)(null),l=Object(d.a)(i,2),g=l[0],k=l[1],S=Object(r.useState)(null),D=Object(d.a)(S,2),I=D[0],L=D[1],U=Object(r.useState)(window.localStorage.getItem("token")||""),R=Object(d.a)(U,2),G=R[0],Q=R[1],V=Object(r.useState)(!0),X=Object(d.a)(V,2),Z=X[0],$=X[1],_=Object(r.useState)(new Date),ee=Object(d.a)(_,2),te=ee[0],ae=ee[1],ne=Object(r.useState)(new Date),re=Object(d.a)(ne,2),ce=re[0],se=re[1],ie=Object(r.useState)(!0),oe=Object(d.a)(ie,2),le=oe[0],ue=oe[1],je=function(e){L({variant:"error",message:e}),$(!1),k({error:!0})},de=Object(r.useCallback)(Object(j.a)(u.a.mark((function e(){var t,a,n,r,c,s,i,o,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q.post("".concat(J,"/details"),{token:G});case 3:t=e.sent,a=t.data,n=a.reservations,r=a.state,c=a.licensePlate,s=a.temperature,i=a.consumption,k({reservations:n,state:r,licensePlate:c,temperature:s,consumption:i}),e.next=24;break;case 8:if(e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.t0.response){e.next=13;break}return e.abrupt("return",je("Unknown error!"));case 13:o=e.t0.response.status,e.t1=o,e.next=400===e.t1?17:401===e.t1?19:21;break;case 17:return l="You need to set token!",e.abrupt("break",23);case 19:return l="Login failed",e.abrupt("break",23);case 21:return l="Unknown error!",e.abrupt("break",23);case 23:je(l);case 24:case"end":return e.stop()}}),e,null,[[0,8]])}))),[G]);!function(e,t){var a=Object(r.useRef)();Object(r.useEffect)((function(){a.current=e}),[e]),Object(r.useEffect)((function(){function e(){a.current()}if(null!==t){var n=setInterval(e,t);return function(){return clearInterval(n)}}}),[t])}(de,Z?5e3:null),Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:de();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[de]);var be=function(){var e=Object(j.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(o.a)(Object(o.a)({},he()),{},{duration:c,eco:!1,token:G}),e.prev=1,e.next=4,q.post("".concat(J,"/timer"),t);case 4:L({variant:"success",message:"Timer sent to gateway successfully!"}),k(null),de(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),L({variant:"error",message:e.t0.toString()});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q.delete("".concat(J,"/timer"),{data:{token:G}});case 3:L({variant:"success",message:"All timers deleted successfully!"}),de(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),L({variant:"error",message:e.t0.toString()});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),he=function(){if(le)return{endDate:W()().format("DD.MM.YYYY"),endTime:W()().add(c,"minutes").format("HH:mm")};var e=W()(te),t=W()(ce);return{endDate:e.format("DD.MM.YYYY"),endTime:t.format("HH:mm")}};return Object(n.jsx)("div",{className:"container",children:Object(n.jsxs)(x.a,{style:{maxWidth:300,width:300},children:[I?Object(n.jsx)(B.a,{severity:I.variant,children:I.message}):null,function(){if(!g)return Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(h.a,{children:Object(n.jsx)(Y.a,{})})})});if(g.error)return Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(h.a,{children:Object(n.jsx)(b.a,{variant:"h6",children:"Tolppa status is unknown"})})})});var e=function(e){var t="DD.MM.YYYY HH:mm",a=W()();return e.find((function(e){var n=e.dateStart,r=e.dateEnd,c=e.timeStart,s=e.timeEnd,i=W()("".concat(n," ").concat(c),t),o=W()("".concat(r," ").concat(s),t);return i.isBefore(a)&&o.isAfter(a)}))}(g.reservations||[]),t=e?W()().diff(W()("".concat(e.dateStart," ").concat(e.timeStart),"DD.MM.YYYY HH:mm"),"minutes"):0;return Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsxs)(m.a,{children:[Object(n.jsx)(h.a,{className:g&&g.state?"status-on":"status-off",children:g&&g.state?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(b.a,{variant:"h6",children:"Your tolppa is on!"}),Object(n.jsxs)(b.a,{variant:"body1",children:["Car heated for ",t,"min!"," ","".concat(g.consumption,"W")]})]}):Object(n.jsx)(b.a,{variant:"h6",children:"Your tolppa is off!"})}),Object(n.jsxs)(h.a,{children:[Object(n.jsx)(b.a,{variant:"subtitle1",children:g.licensePlate}),Object(n.jsxs)(b.a,{variant:"body1",children:[g.temperature,"\xb0C, ",g.reservations.length,"/2 timers"]})]})]})})}(),g&&g.reservations?Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(N.a,{children:g.reservations.map((function(e,t){var a=e.dateStart,r=e.timeStart,c=e.timeEnd,s=(e.active,W()("".concat(a," ").concat(c),"DD.MM.YYYY HH:mm").diff(W()("".concat(a," ").concat(r),"DD.MM.YYYY HH:mm"),"minutes"));return Object(n.jsxs)(F.a,{children:[Object(n.jsx)(E.a,{children:Object(n.jsx)(P.a,{})}),Object(n.jsx)(T.a,{primary:"".concat(a,", ").concat(r,"-").concat(c),secondary:"".concat(s," minutes")})]},t)}))})})}):null,Object(n.jsxs)(H.a,{utils:A.a,children:[Object(n.jsx)(x.a,{item:!0,xs:12,className:"row",children:Object(n.jsx)(m.a,{children:Object(n.jsx)(h.a,{children:Object(n.jsxs)(x.a,{children:[Object(n.jsx)(x.a,{item:!0,xs:12,className:"center",children:Object(n.jsx)(v.a,{variant:"extended",color:"primary",onClick:function(){return ue(!le)},children:le?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(w.a,{})," Schedule car heating"]}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(y.a,{})," Add quick timer"]})})}),le?Object(n.jsx)(n.Fragment,{children:Object(n.jsxs)(x.a,{item:!0,xs:12,children:[Object(n.jsx)(z.a,{htmlFor:"dur",children:K(c)}),Object(n.jsx)(O.a,{label:"Duration",value:c,min:15,max:200,onChange:function(e,t){return s(t)},"aria-labelledby":"continuous-slider"})]})}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)(x.a,{item:!0,xs:12,children:[Object(n.jsx)(z.a,{htmlFor:"dur",children:K(c)}),Object(n.jsx)(O.a,{label:"Duration",value:c,min:15,max:200,onChange:function(e,t){return s(t)},"aria-labelledby":"continuous-slider"})]}),Object(n.jsx)(x.a,{item:!0,xs:12,className:"form-row",children:Object(n.jsx)(C.a,{disableToolbar:!0,variant:"inline",format:"dd.MM.yyyy",margin:"normal",id:"date-picker-inline",label:"Date for new time",value:te,onChange:ae,KeyboardButtonProps:{"aria-label":"change date"}})}),Object(n.jsx)(x.a,{item:!0,xs:12,className:"form-row",children:Object(n.jsx)(M.a,{ampm:!1,margin:"normal",id:"time-picker",label:"When the car should be ready",value:ce,onChange:se,KeyboardButtonProps:{"aria-label":"change time"}})})]}),Object(n.jsx)(x.a,{item:!0,xs:12,style:{textAlign:"center",paddingTop:"1rem"},children:Object(n.jsx)(f.a,{variant:"contained",disabled:!G||g&&g.error,color:"primary",onClick:be,children:"Heat the car"})})]})})})}),Object(n.jsx)(m.a,{style:{textAlign:"center"},children:Object(n.jsxs)(h.a,{className:"button-card",children:[Object(n.jsx)(f.a,{size:"large",color:"secondary",variant:"outlined",disabled:!G||g&&g.error,onClick:me,children:"Clear all timers"}),Object(n.jsx)(f.a,{size:"large",color:"primary",variant:"outlined",onClick:function(){return window.open("https://eparking.fi/fi/u#/reservations")},children:"Manage reservations!"})]})}),Object(n.jsx)(x.a,{item:!0,xs:12,className:"row pad",children:Object(n.jsxs)(m.a,{style:{padding:".7rem .5rem"},children:[Object(n.jsx)(z.a,{children:"Add cookies for sign in"}),Object(n.jsx)(p.a,{value:G,onChange:function(e){var t=e.target.value;window.localStorage.setItem("token",t),Q(t),$(!!t)},rowsMin:10,rowsMax:10}),Object(n.jsx)(f.a,{size:"small",color:"primary",variant:"outlined",onClick:function(){window.localStorage.setItem("token",""),Q(""),$(!1)},children:"Clear cookies"})]})})]})]})})},R=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,200)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;a(e),n(e),r(e),c(e),s(e)}))};i.a.render(Object(n.jsx)(c.a.StrictMode,{children:Object(n.jsx)(U,{})}),document.getElementById("root")),R()}},[[144,1,2]]]);
//# sourceMappingURL=main.58ff6d85.chunk.js.map